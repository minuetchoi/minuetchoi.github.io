---
layout: post
title: "[Oracle] 11. SQL - range 2 preceding"
date: 2022-02-15 15:36:00 +0900
category: oracle
---

# 1. rows 2 preceding

### 사용처
데이터 분석이나 이동평균, 이동총계를 구하고 싶을 때 사용한다.

<br>

rows 2 preceding과 다른점은, rows가 행수 지정인 것에 반해, Range는 sortkey 범위 지정이라는 점이다.

<br>

sortkey가 자신행보다 2작은 행이므로, 자신행까지 가산대상으로 이동총계를 구해보자


```sql
create tablee idotT(sortkey, val) as
select 1,  10 from dual
union all
select 2,  20 from dual
union all
select 5,  60 from dual
union all
select 7, 100 from dual
union all
select 8, 200 from dual
union all
select 9, 600 from dual
```

sortkey를 오름차순으로, 앞 2행과 자신의 행을 가산대상으로 하여 이동총계를 구해보자

```sql
select sortkey,
       val,
       sum(val) over(order by sortkey range 2 preceding) as moveSum
from   idotT;
```

```sql
sortkey  val  moveSum
-------  ---  --------
      1   10        10
      2   20        30
      5   60        60
      7  100       160
      8  200       300
      9  600       900
```